<!doctype html>
<head>
    <link rel="stylesheet" href="http://code.jquery.com/qunit/qunit-git.css" type="text/css" media="screen">
    <script type="text/javascript" src="http://code.jquery.com/qunit/qunit-git.js"></script>

    <script type="text/javascript" src="../../node_modules/requirejs/require.js"></script>
    <script>
        require([ "../looper" ], function( looper ) {

            //setup & initialize
            test( "setup & initialize", function(){
                var methods = [ 'start', 'stop', 'clear', 'add', 'rate' ];

                //confirm expected methods
                for ( var method in methods ){
                    ok( typeof looper[ methods[ method ] ] === 'function', 'looper includes the "' + methods[ method ] + '" method' )
                }
            });

            //start & run loop
            test( 'start & run loop', function(){
                var n = 0,
                    loopLength = 10,
                    testDuration = 400,
                    startTime = Date.now(),
                    endTime = Date.now(),
                    testFunc1 = function(){ n = n + 1; endTime = Date.now(); };

                looper.start( testFunc1, loopLength );

                ok( looper.rate() === loopLength, 'looper is running at the expected rate of ' + looper.rate() + ' ms' );
                stop();

                setTimeout(function(){
                    looper.stop();

                    ok( n > 0 && n <= ( testDuration / loopLength ), 'looper ran ' + n + ' times' );
                    ok( endTime - startTime, 'looper ran in ' + ( endTime - startTime ) + ' miliseconds' );

                    looper.clear();
                    start();
                }, testDuration );
            });

            //add & remove multiple functions to looper
            asyncTest( 'add & remove functions to running loop', function(){
                var n = 0,
                    nGoal = 25,
                    x = 0,
                    xGoal = 5,
                    y = "",
                    yGoal = 'awwww yeaaaah!',
                    loopLength = 10,
                    testDuration = 500,
                    testFunc1 = function(){ n = n + 1; if ( n === nGoal ) { return false; } },
                    testFunc2 = function(){ x = x + 1; if ( x === xGoal ) { return false; } },
                    testFunc3 = function(){ if ( n === 10 ) { y = yGoal; } };

                looper.add( testFunc3 );
                looper.start( testFunc1, loopLength );

                setTimeout(function(){
                    looper.add( testFunc2 );
                }, 200 );

                setTimeout(function(){
                    looper.stop();
                }, 400 );

                setTimeout(function(){
                    ok( n === nGoal, 'testFunc1 ran successfully - n = ' + n );
                    ok( x === xGoal, 'testFunc2 ran successfully - x = ' + x );
                    ok( y === yGoal, 'testFunc2 ran successfully - y = ' + yGoal );

                    start();
                }, testDuration );
            });

        });
    </script>
</head>
<body>
    <h1 id="qunit-header">Looper AMD Module: Test Suite</h1>
    <h2 id="qunit-banner"></h2>
    <div id="qunit-testrunner-toolbar"></div>
    <h2 id="qunit-userAgent"></h2>
    <ol id="qunit-tests"></ol>
</body>
</html>
