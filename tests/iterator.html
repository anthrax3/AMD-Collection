<!doctype html>
<head>
	<title>Iterator AMD Module: Test Suite</title>

	<link rel="stylesheet" href="http://code.jquery.com/qunit/qunit-git.css" type="text/css" media="screen">
	<script type="text/javascript" src="http://code.jquery.com/qunit/qunit-git.js"></script>

	<script type="text/javascript" src="../../node_modules/requirejs/require.js"></script>
	<script>
		Object.keys = Object.keys || function (o) {
			var result = [];
			for (var name in o) {
				if (o.hasOwnProperty(name)) {
					result.push(name);
				}
			}
			return result;
		};

		require([ '../iterator' ], function( Iterator ) {

			module("Iterator", {
				setup: function() {
					strictEqual( typeof l, 'undefined', 'iterator instance is undefined, test is using a clean instance' );
				}
			});

			test( 'environment', function(){
				notStrictEqual( window.location.protocol, 'file:', 'Not running tests under the "file:" protocol' );
			});

			test( 'module has the correct methods & properties', function(){
				var l,
					expected = {
						'has': 'function',
						'hasNext': 'function',
						'hasPrev': 'function',
						'isFirst': 'function',
						'isLast': 'function',
						'get': 'function',
						'getNext': 'function',
						'getPrev': 'function',
						'current': 'function',
						'next': 'function',
						'prev': 'function',
						'first': 'function',
						'last': 'function',
						'indexOf': 'function',
						'setIndex': 'function',
						'loop': 'function',
						'add': 'function',
						'remove': 'function',
						'update': 'function',
						'filter': 'function',
						'each': 'function',
						'collection': 'object',
						'index': 'number',
						'length': 'number'
					};

				l = Iterator( [ 'fe', 'fi', 'fo', 'fum' ] );

				expect( 2 + Object.keys( expected ).length );

				strictEqual( Object.keys( Iterator.prototype ).length + Object.keys( l ).length, Object.keys( expected ).length, 'all ' + Object.keys( expected ).length + ' methods have been identified' );

				for ( var prop in expected ) {
					strictEqual( typeof l[ prop ], expected[ prop ], 'module includes the "' + prop + '" method / property' );
				}
			});

			test( 'constructor - new Iterator()', function(){
				strictEqual( typeof Iterator, 'function', 'Iterator constructor is available' );

				var l = Iterator( [ 1, 2, 3, 4, 5 ] );

				strictEqual( l.length, 5, 'passing an array to constructor creates a collection with the correct number of items' );
				strictEqual( typeof l.collection, 'object', 'collection is available within iterator instance' );
				strictEqual( l.get( 2 ), 3, 'collection contents are correct' );

				l = new Iterator();
				strictEqual( l.length, 0, 'calling constructor without any arguments creates a collection without any items' );

				l = Iterator( 'q' );
				strictEqual( l.length, 1, 'passing a single, non-array argument to constructor creates a collection with one item' );
				strictEqual( l.get( 0 ), 'q', 'collection contents are correct' );

				l = new Iterator( 'a', 'b', 'c', 'd' );
				strictEqual( l.length, 4, 'passing multiple arguments to constructor creates a collection with the correct number of items' );
				strictEqual( l.get( 2 ), 'c', 'collection contents are correct' );

				l = Iterator({ a:1, b:2, c: 3 });
				strictEqual( l.length, 1, 'passing a single object to constructor creates a collection with one item' );
				strictEqual( l.get( 0 ).b, 2, 'collection contents are correct' );

				l = new Iterator({ a:1, b:2, c: 3 }, { e:4, f:5, g:6 });
				strictEqual( l.length, 2, 'passing two objects to constructor creates a collection with two items' );
				strictEqual( l.get( 1 ).f, 5, 'collection contents are correct' );

				l = Iterator( { a:1, b:2 }, 10, 11, 12, 'a', 'b', 'c')
				strictEqual( l.length, 7, 'passing arguments of multiple types to constructor creates a collection with the correct number of items' );
				ok(
					l.get( 0 ).b === 2 &&
					l.get( 2 ) === 11 &&
					l.get( 4 ) === 'a',
					'collection contents are correct'
				);
			});

			test( 'property - .idx', function(){
				var l = Iterator( [ 1, 2, 3, 4, 5 ] );

				strictEqual( l.index, 0, 'initial .idx value is correct' );
				l.last();
				strictEqual( l.index, 4, '.idx value is correct after calling .last()' );
				l.first();
				strictEqual( l.index, 0, '.idx value is correct after calling .first()' );
				l.next();
				strictEqual( l.index, 1, '.idx value is correct after calling .next()' );
				l.prev();
				strictEqual( l.index, 0, '.idx value is correct after calling .prev()' );
				l.setIndex( 3 );
				strictEqual( l.index, 3, '.idx value is correct after calling .setIndex()' );
				l.get( 3 );
				strictEqual( l.index, 3, '.idx value should not change after calling .get()' );
			});

			test( 'property - .length', function(){
				var l;

				l = Iterator( [ 1, 2, 3, 4, 5 ] );

				strictEqual( l.length, 5, 'newly initialized iterator instance has correct length' );
				l.add( [ 6 ] );
				strictEqual( l.length, 6, 'instance has correct length after adding an item to the collection' );
				l.remove( 0 );
				strictEqual( l.length, 5, 'instance has correct length after removing item to the collection' );
				l.add( [ 7, 8, 9 ] );
				strictEqual( l.length, 8, 'instance has correct length after adding multiple items to the collection' );
			});

			test( 'method - .has()', function(){
				var l;

				l = Iterator( [ 0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14 ] );

				strictEqual( l.has( 0 ), true, 'has zero idx - .has( 0 )' );
				strictEqual( l.has( 7 ), true, 'has 7th idx - .has( 7 )' );
				strictEqual( l.has( 15 ), false, 'does not have 15th idx - .has( 15 )' );
			});

			test( 'method - .hasNext()', function(){
				var l;

				l = Iterator( [ 1, 2, 3, 4, 5 ] );

				strictEqual( l.hasNext(), true, 'newly initialized iterator instance has next item' );
				l.last();
				strictEqual( l.hasNext(), false, 'next item is not available when current item is last' );
				l.setIndex( 3 );
				strictEqual( l.hasNext(), true, 'next item is available when current item is in the middle of the collection' );
				l.first();
				strictEqual( l.hasNext(), true, 'next item is available when current item is first' );
			});

			test( 'method - .hasPrev()', function(){
				var l;

				l = Iterator( [ 1, 2, 3, 4, 5 ] );

				strictEqual( l.hasPrev(), false, 'previous item is not available when using a newly initialized iterator instance' );
				l.last();
				strictEqual( l.hasPrev(), true, 'previous item is available when current item is last' );
				l.setIndex( 3 );
				strictEqual( l.hasPrev(), true, 'previous item is available when current item is in the middle of the collection' );
				l.first();
				strictEqual( l.hasPrev(), false, 'previous item is not available when current item is first' );
			});

			test( 'method - .isFirst()', function(){
				var l;

				l = Iterator( [ 1, 2, 3, 4, 5 ] );

				strictEqual( l.isFirst(), true, 'isFirst() returns true when called on a newly initialized iterator instance' );
				l.last();
				strictEqual( l.isFirst(), false, 'isFirst() returns false when current item is last item' );
				l.setIndex( 3 );
				strictEqual( l.isFirst(), false, 'isFirst() returns false when current item is in the middle of the collection' );
				l.first();
				strictEqual( l.isFirst(), true, 'isFirst() returns true when current item is first' );
				l.last();
				strictEqual( l.isFirst( 0 ), true, 'isFirst( 0 ) returns true' );
				strictEqual( l.isFirst( 3 ), false, 'isFirst( 3 ) returns false' );
			});

			test( 'method - .isLast()', function(){
				var l;

				l = Iterator( [ 1, 2, 3, 4, 5 ] );

				strictEqual( l.isLast(), false, 'isLast() returns false when called on a newly initialized iterator instance' );
				l.last();
				strictEqual( l.isLast(), true, 'isLast() returns true when current item is last item' );
				l.setIndex( 3 );
				strictEqual( l.isLast(), false, 'isLast() returns false when current item is in the middle of the collection' );
				l.first();
				strictEqual( l.isLast(), false, 'isLast() returns false when current item is first' );
				strictEqual( l.isLast( 0 ), false, 'isFirst( 0 ) returns false' );
				strictEqual( l.isLast( 3 ), false, 'isFirst( 3 ) returns false' );
				strictEqual( l.isLast( l.length - 1 ), true, 'isFirst( l.length -1 ) returns true' );
			});

			test( 'method - .get()', function(){
				var l;

				l = Iterator( [ 1, 2, 3, 4, 5 ] );

				strictEqual( l.get( 0 ), 1, 'got 1st item' );
				strictEqual( l.get( 3 ), 4, 'got 3rd item' );
				strictEqual( typeof l.get( 999 ), 'undefined', 'undefined returned when getting unavailable idx' );
			});

			test( 'method - .getNext()', function(){
				var l;

				l = Iterator( [ 1, 2, 3, 4, 5 ] );
				l.setIndex( 2 );

				strictEqual( l.getNext(), 4, 'got next item' );
				strictEqual( l.index, 2, 'calling .getNext() does not increment idx' );

				l.last();
				strictEqual( typeof l.getNext(), 'undefined', 'undefined returned when next item is unavailable' );
			});

			test( 'method - .getPrev()', function(){
				var l;

				l = Iterator( [ 1, 2, 3, 4, 5 ] );
				l.setIndex( 3 );

				strictEqual( l.getPrev(), 3, 'got previous item' );
				strictEqual( l.index, 3, 'calling .getNext() does not increment idx' );

				l.first();
				strictEqual( typeof l.getPrev(), 'undefined', 'undefined returned when previous item is unavailable' );
			});

			test( 'method - .current()', function(){
				var l;

				l = Iterator( [ 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13 ] );

				strictEqual( l.current(), 1, 'initial .current() value is correct' );
				l.next();
				strictEqual( l.current(), 2, 'after requesting .next(), .current() value is correct' );
				l.last();
				strictEqual( l.current(), 13, 'after requesting .last(), .current() value is correct' );
				l.first();
				strictEqual( l.current(), 1, 'after requesting .first(), .current() value is correct' );
				l.setIndex( 6 );
				strictEqual( l.current(), 7, 'after setting a arbitrary index via .setIndex(), .current() value is correct' );
				l.last();
				l.loop().next();
				strictEqual( l.current(), 1, 'after looping to 1st via .loop().next(), .current() value is correct' );
				l.first();
				l.loop().prev();
				strictEqual( l.current(), 13, 'after looping to last via .loop().prev(), .current() value is correct' );
			});

			test( 'method - .next()', function(){
				var l;

				l = Iterator( [ 1, 2, 3, 4, 5 ] );

				strictEqual( l.current(), 1, 'current item is correct [' + l.current() + ']' );
				while ( l.hasNext() ){
					strictEqual( typeof l.next(), 'number', 'able to retreive next item [' + l.current() + ']' );
				}
				strictEqual( l.isLast(), true, 'current item is last item' );
				strictEqual( l.next(), null, '.next() returns null when current item is last item' );
			});

			test( 'method - .prev()', function(){
				var l;

				l = Iterator( [ 1, 2, 3, 4, 5 ] );
				l.last();

				strictEqual( l.current(), 5, 'current item is correct [' + l.current() + ']' );
				while ( l.hasPrev() ){
					strictEqual( typeof l.prev(), 'number', 'able to retreive prev item [' + l.current() + ']' );
				}
				strictEqual( l.isFirst(), true, 'current item is first item' );
				strictEqual( l.prev(), null, '.prev() returns null when current item is first item' );
			});

			test( 'method - .first()', function(){
				var l;

				l = Iterator( [ 1, 2, 3, 4, 5 ] );
				
				l.last();
				strictEqual( l.isLast(), true, 'current item is last item' );
				l.first();
				strictEqual( l.isFirst(), true, 'current item is first item' );
			});

			test( 'method - .last()', function(){
				var l;

				l = Iterator( [ 1, 2, 3, 4, 5 ] );
				
				strictEqual( l.isFirst(), true, 'current item is first item' );
				l.last();
				strictEqual( l.isLast(), true, 'current item is last item' );
			});

			test( 'method - .indexOf()', function(){
				var l,
					first = { first: 'first' },
					second = { second: 'second' },
					third = { third: 'third' };

				l = Iterator( [ 0, 'a', 'b', 'c', 'd', 'e', 'f' ] );

				strictEqual( l.indexOf( 0 ), 0, 'first item has correct index' );
				strictEqual( l.indexOf( 'f' ), 6, 'last item has correct index' );
				strictEqual( l.indexOf( 'd', 4 ), 4, 'item\'s index is correct when providing "fromIdx" argument' );

				l = new Iterator([ first, second, third ]);

				strictEqual( l.indexOf( first ), 0, 'using a collection of objects, first item has correct index' );
				strictEqual( l.indexOf( third ), 2, 'using a collection of objects, last item has correct index' );
				strictEqual( l.indexOf( second, 1 ), 1, 'using a collection of objects, item\'s index is correct when providing "fromIdx" argument' );
			});

			test( 'method - .setIndex()', function(){
				var l;

				l = Iterator( [ 1, 2, 3, 4, 5 ] );

				strictEqual( l.first(), 1, 'newly initialized iterator instance has the correct first item' );
				strictEqual( l.setIndex( 3 ).current(), 4, 'current item is correct after setting new index' );
				raises( function(){ l.setIndex( 666 ) }, 'setting index to an unknown / unavailable item throws an error' );
			});

			test( 'method - .loop()', function(){
				var l = Iterator(['00','01','02','03','04','05','06','07','08','09']);

				strictEqual( l.current(), '00', 'current item is correct' );
				strictEqual( l.loop().getNext(), '01', '.getNext() returns correct item' );
				strictEqual( l.loop().next(), '01', '.next() returns correct item' );
				strictEqual( l.last(), '09', 'last item is correct' );
				strictEqual( l.loop().getNext(), '00', 'requesting .getNext() at end of collection returns 1st item' );
				strictEqual( l.loop().next(), '00', 'requesting .next() at end of collection returns 1st item and increments the collection\'s idx' );
				strictEqual( l.current(), '00', 'current item is correct' );
				strictEqual( l.loop().next(), '01', '.next() returns correct item' );

				strictEqual( l.setIndex( 3 ).prev(), '02', 'setting an idx and requesting .prev() returns correct item' );
				strictEqual( l.first(), '00', 'first item is correct' );
				strictEqual( l.loop().getPrev(), '09', 'requesting .getPrev() at start of collection returns last item' );
				strictEqual( l.loop().prev(), '09', 'requesting .prev() at start of collection returns last item and increments the collection\'s idx' );
				strictEqual( l.current(), '09', 'current item is correct' );
				strictEqual( l.loop().getPrev(), '08', '.getPrev() returns correct item' );
				strictEqual( l.loop().prev(), '08', '.prev() returns correct item' );

				l = Iterator(['00','01','02','03','04','05','06','07','08','09']);
				strictEqual( l.loop().getPrev(), '09', 'requsting .getPrev() after initializing a collection returns correct item' );
				strictEqual( l.loop().prev(), '09', 'requsting .prev() after initializing a collection returns correct item and increments the collection\'s idx' );
				strictEqual( l.current(), '09', 'current item is correct' );
			});

			test( 'method - .add()', function(){
				var l;

				l = Iterator( [ 'matt', 'mirande' ] );

				strictEqual( l.length, 2, 'newly initialized iterator instance has correct length' );
				l.add( [ 'edward' ], 1 );
				strictEqual( l.get( 1 ), 'edward', 'item added at the correct index' );
				strictEqual( l.length, 3, 'updated collection has the correct length' );
				strictEqual( l.collection.join( ' ' ), 'matt edward mirande', 'contents of the collection are correct' );
				l.add( [ 'rulez' ] );
				strictEqual( l.last(), 'rulez', 'new item added to end of collection by default' );
				strictEqual( l.collection.join( ' ' ), 'matt edward mirande rulez', 'contents of the collection are correct' );
				l.add( [ '!', '!', '!', '!' ] );
				strictEqual( l.collection.join( ' ' ), 'matt edward mirande rulez ! ! ! !', 'contents of the collection are correct after adding multiple items' );

				l = Iterator();
				strictEqual( l.length, 0, 'iterator instance was reset' );
				l.add( 'hello there!' );
				strictEqual( l.length, 1, 'passing a single, non-array argument to .add() adds an item to the collection' );
				strictEqual( l.get( 0 ), 'hello there!', 'collection contents are correct' );
				l.add({ a:1, b:2, c: 3 });
				strictEqual( l.length, 2, 'passing a single object to .add() adds an object to the collection' );
				strictEqual( l.get( 1 ).b, 2, 'collection contents are correct' );
			});

			test( 'method - .remove()', function(){
				var l;

				l = Iterator( [ 'a', 'b', 'c', 'd', 'e' ] );

				strictEqual( l.length, 5, 'newly initialized iterator instance has correct length' );
				l.remove( 1 )
				strictEqual( l.collection.join( '' ), 'acde', 'target item removed properly' );
			});

			test( 'method - .update()', function(){
				var l;

				l = Iterator( [ 'a', 'b', 'c' ] );

				l.update( 0, 'b' );
				l.update( 2, 'd' );
				l.update( 1, 'a' );

				strictEqual( l.collection.join( '' ), 'bad', 'target items updated properly' );
				raises( function(){ l.update( 'nope', 666 ) }, 'updating an unknown index throws an error' );
			});

			test( 'method - .filter()', function(){
				var l,
					newL;

				l = Iterator( [ 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20, 21, 22, 23, 24, 25, 26, 27, 28, 29, 30 ] );

				strictEqual( l.length, 30, 'newly initialized iterator instance is the correct length' );

				newL = l.filter( function( item ){ return item >= 10 && item < 20; } );

				strictEqual( newL.length, 10, 'filtered instance is the correct length' );
				strictEqual( newL instanceof Iterator, true, 'filtered instance is a child of Iterator' );
				strictEqual( newL.current(), 10, 'filtered instance has correct current item' );
			});

			test( 'method - .each()', function(){
				var l,
					localObj = { iAm: "localObj" },
					passes = true,
					callback = function(){
						strictEqual( )
					};

				window.iAm = "globalObj";

				l = Iterator( [ 1, 2, 3, 4, 5, 6, 7, 8, 9, 10 ] );

				raises( function(){ l.each( 'nope' ) }, 'calling .each() without an argument type of "function" throws an error' );

				l.each(function( item, idx ){
					strictEqual( l.setIndex( idx ).current(), item, '.each() received the correct item ' + item );
					strictEqual( l.index, idx, '.each() is using the correct index value ' + idx );
				});

				l.each( function(){
					if ( this.iAm != localObj.iAm ){
						passes = false;
					}
				}, localObj );

				ok( passes, 'context is set and used when calling .each()' );

				l.each( function(){
					if ( this.iAm != window.iAm ){
						passes = false;
					}
				});

				ok( passes, 'calling .each() without a context argument sets context to window / global' );
			});
		});
	</script>
</head>
<body>
	<h1 id="qunit-header">Iterator AMD Module: Test Suite</h1>
	<h2 id="qunit-banner"></h2>
	<div id="qunit-testrunner-toolbar"></div>
	<h2 id="qunit-userAgent"></h2>
	<ol id="qunit-tests"></ol>
</body>
</html>
